<!-- Wellness Assessment Modal (site-wide) -->
<div class="wellness-modal" id="wellnessModal">
  <div class="wellness-modal__overlay" onclick="closeWellnessModal()"></div>
  <div class="wellness-modal__container">
    <button type="button" class="wellness-modal__close" onclick="closeWellnessModal()" aria-label="Close">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
    <div class="wellness-modal__scroll">

    <!-- Progress Indicator (4 steps) -->
    <div class="wellness-modal__progress">
      <div class="step-dot step-dot--active" data-step="1"></div>
      <div class="step-dot" data-step="2"></div>
      <div class="step-dot" data-step="3"></div>
      <div class="step-dot" data-step="4"></div>
    </div>

    <!-- Pre-fill Notice (removed — data silently pre-filled) -->

    <!-- Step 1: Personal & Employment -->
    <div class="wellness-step" id="step-1">
      <h3 style="margin-bottom: 1.5rem;">Personal &amp; Employment</h3>

      <div class="form-group">
        <label>Your age</label>
        <input type="number" id="user-age" min="18" max="70" placeholder="e.g. 35" class="form-input">
      </div>

      <div class="form-group">
        <label>Are you a smoker?</label>
        <div style="display: flex; gap: 1rem;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="smoker-status" id="smoker-yes" value="yes" style="margin-right: 0.5rem;">
            Yes
          </label>
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="smoker-status" id="smoker-no" value="no" checked style="margin-right: 0.5rem;">
            No
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>What is your employment status?</label>
        <select id="employment-status" class="form-select">
          <option value="">Select...</option>
          <option value="paye-12">PAYE employed (12+ months)</option>
          <option value="paye-under">PAYE employed (under 12 months)</option>
          <option value="self-2">Self-employed (2+ years)</option>
          <option value="self-under">Self-employed (under 2 years)</option>
          <option value="contractor">Contractor</option>
          <option value="irregular">Irregular/variable income</option>
        </select>
      </div>

      <div class="form-group">
        <label>Your monthly take-home income (after tax) (&pound;)</label>
        <input type="number" id="monthly-income" placeholder="e.g. 2,500" class="form-input">
        <p class="form-hint">The amount that actually hits your bank account each month</p>
      </div>

      <div class="form-group" id="gross-income-group">
        <label>Your gross annual salary (before tax) (&pound;) <span class="form-label__optional">(optional)</span></label>
        <input type="number" id="gross-annual-income" placeholder="e.g. 45000" class="form-input">
        <p class="form-hint">Your salary before tax and deductions. If left blank, we'll estimate from your take-home pay.</p>
      </div>

      <div class="form-group">
        <label>Do you have a partner in a joint application?</label>
        <div style="display: flex; gap: 1rem;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="has-partner" id="partner-yes" value="yes" style="margin-right: 0.5rem;" onchange="togglePartnerIncome()">
            Yes
          </label>
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="has-partner" id="partner-no" value="no" checked style="margin-right: 0.5rem;" onchange="togglePartnerIncome()">
            No
          </label>
        </div>
      </div>

      <div class="form-group" id="partner-income-group" style="display: none;">
        <label>Partner's monthly take-home income (&pound;)</label>
        <input type="number" id="partner-income" placeholder="e.g. 2,000" class="form-input">
      </div>

      <div class="form-group" id="partner-gross-income-group" style="display: none;">
        <label>Partner's gross annual salary (&pound;) <span class="form-label__optional">(optional)</span></label>
        <input type="number" id="partner-gross-income" placeholder="e.g. 38000" class="form-input">
      </div>

      <div class="form-group">
        <label>How would you describe your credit history?</label>
        <select id="credit-history" class="form-select">
          <option value="">Select...</option>
          <option value="clean">Clean - no issues</option>
          <option value="minor">Minor historic issues (3+ years ago)</option>
          <option value="recent">Some recent issues (last 3 years)</option>
          <option value="severe">Significant adverse credit</option>
        </select>
      </div>

      <button class="btn btn--primary" style="width: 100%; margin-top: 1rem;" onclick="nextStep(2)">Continue &rarr;</button>
    </div>

    <!-- Step 2: Property & Finances (merged old steps 2+3) -->
    <div class="wellness-step" id="step-2" style="display: none;">
      <h3 style="margin-bottom: 1.5rem;">Property &amp; Finances</h3>

      <div class="form-group">
        <label>Approximate property value you're looking at (&pound;)</label>
        <input type="number" id="property-value" placeholder="250,000" class="form-input">
      </div>

      <div class="form-group">
        <label>How much deposit do you have saved? (&pound;)</label>
        <input type="number" id="deposit-amount" placeholder="25,000" class="form-input">
      </div>

      <div class="form-group">
        <label>Total accessible savings (&pound;)</label>
        <input type="number" id="accessible-savings" placeholder="e.g. 5,000" class="form-input">
        <p class="form-hint">Money you could get to within a week &mdash; current accounts, easy-access savings, ISAs</p>
      </div>

      <div class="form-group">
        <label>Your essential monthly outgoings (&pound;)</label>
        <input type="number" id="monthly-essentials" placeholder="e.g. 2,000" class="form-input">
        <p class="form-hint">Mortgage/rent, bills, food, transport &mdash; the basics to keep going</p>
      </div>

      <div class="form-group">
        <label>Are you saving money each month?</label>
        <div style="display: flex; gap: 1rem;">
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="saving-monthly" id="saving-yes" value="yes" style="margin-right: 0.5rem;">
            Yes
          </label>
          <label style="display: flex; align-items: center; cursor: pointer;">
            <input type="radio" name="saving-monthly" id="saving-no" value="no" style="margin-right: 0.5rem;">
            No
          </label>
        </div>
      </div>

      <div class="form-group">
        <label>After all expenses, do you typically have money left over each month?</label>
        <select id="monthly-surplus" class="form-select">
          <option value="">Select...</option>
          <option value="surplus">Yes, I regularly save</option>
          <option value="breakeven">I roughly break even</option>
          <option value="occasional">Occasionally use credit</option>
          <option value="reliant">Reliant on credit</option>
        </select>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        <button class="btn btn--secondary" style="flex: 1;" onclick="nextStep(1)">Back</button>
        <button class="btn btn--primary" style="flex: 1;" onclick="nextStep(3)">Continue &rarr;</button>
      </div>
    </div>

    <!-- Step 3: Protection -->
    <div class="wellness-step" id="step-3" style="display: none;">
      <h3 style="margin-bottom: 1.5rem;">Protection</h3>

      <h4 style="font-size: 1rem; margin-bottom: 1rem; color: var(--text-secondary);">Employer Benefits</h4>

      <div class="form-group">
        <label>Does your employer pay sick pay above the statutory minimum?</label>
        <select id="employer-sick-pay" class="form-select" onchange="toggleSickPayDuration()">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
          <option value="not-sure">Not sure</option>
        </select>
      </div>

      <div class="form-group" id="sick-pay-duration-group" style="display: none;">
        <label>If yes: Full pay for how long?</label>
        <select id="sick-pay-duration" class="form-select">
          <option value="">Select...</option>
          <option value="1">1 month</option>
          <option value="2">2 months</option>
          <option value="3">3 months</option>
          <option value="6">6+ months</option>
          <option value="dont-know">Don't know</option>
        </select>
      </div>

      <div class="form-group">
        <label>Does your employer provide Death in Service benefit?</label>
        <select id="employer-death-in-service" class="form-select" onchange="toggleDeathInServiceMultiple()">
          <option value="">Select...</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
          <option value="not-sure">Not sure</option>
        </select>
      </div>

      <div class="form-group" id="death-in-service-multiple-group" style="display: none;">
        <label>Multiple of salary</label>
        <select id="death-in-service-multiple" class="form-select">
          <option value="">Select...</option>
          <option value="1">1x annual salary</option>
          <option value="2">2x annual salary</option>
          <option value="3">3x annual salary</option>
          <option value="4">4x annual salary</option>
          <option value="other">Other/Don't know</option>
        </select>
      </div>

      <h4 style="font-size: 1rem; margin: 1.5rem 0 1rem; color: var(--text-secondary);">Personal Protection</h4>

      <div class="form-group">
        <label>Do you have life insurance?</label>
        <select id="life-insurance" class="form-select">
          <option value="">Select...</option>
          <option value="full">Yes, adequate cover</option>
          <option value="partial">Some, but may not be enough</option>
          <option value="none">No</option>
        </select>
      </div>

      <div class="form-group">
        <label>Do you have income protection insurance?</label>
        <select id="income-protection" class="form-select" onchange="toggleIPDetails()">
          <option value="">Select...</option>
          <option value="full">Yes</option>
          <option value="partial">Partial/through employer only</option>
          <option value="none">No</option>
        </select>
      </div>

      <div id="ip-details-group" style="display: none; background: #F8FAFC; padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; font-weight: 600;">Income Protection Details</p>

        <div class="form-group">
          <label>Monthly benefit amount (&pound;)</label>
          <input type="number" id="ip-monthly-benefit" placeholder="e.g. 2000" min="0" step="100" class="form-input">
        </div>

        <div class="form-group">
          <label>Deferred period (how long before benefit starts?)</label>
          <select id="ip-deferred-period" class="form-select">
            <option value="">Select...</option>
            <option value="1">1 month</option>
            <option value="2">2 months</option>
            <option value="3">3 months</option>
            <option value="6">6 months</option>
            <option value="12">12 months</option>
          </select>
        </div>

        <div class="form-group">
          <label>Benefit period (how long does it pay?)</label>
          <select id="ip-benefit-period" class="form-select">
            <option value="">Select...</option>
            <option value="1">1 year</option>
            <option value="2">2 years</option>
            <option value="5">5 years</option>
            <option value="retirement">Until retirement (age 65)</option>
            <option value="lifetime">Lifetime</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Do you have critical illness cover?</label>
        <select id="critical-illness" class="form-select">
          <option value="">Select...</option>
          <option value="full">Yes</option>
          <option value="partial">Partial</option>
          <option value="none">No</option>
        </select>
      </div>

      <div class="form-group" style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--medium-grey);">
        <label>Email (Optional) - Receive your report and occasional mortgage tips</label>
        <input type="email" id="user-email" placeholder="your.email@example.com" class="form-input">
        <p class="form-hint">
          We respect your privacy. By providing your email, you consent to receive your wellness report and occasional helpful mortgage information. You can unsubscribe anytime. See our <a href="/privacy/" style="color: var(--brand-orange);">privacy policy</a>.
        </p>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        <button class="btn btn--secondary" style="flex: 1;" onclick="nextStep(2)">Back</button>
        <button class="btn btn--primary" style="flex: 1;" onclick="nextStep(4)">Continue &rarr;</button>
      </div>
    </div>

    <!-- Step 4: Perception Check -->
    <div class="wellness-step" id="step-4" style="display: none;">
      <h3 style="margin-bottom: 1.5rem;">One Last Thing...</h3>
      <p style="margin-bottom: 2rem; color: var(--text-secondary);">Before we crunch the numbers, we'd like to know what you <em>think</em>.</p>

      <div class="form-group">
        <label>If you or your partner couldn't work from tomorrow, how many months do you think your savings could cover your mortgage/rent and essential bills?</label>
        <div style="margin: 1.5rem 0;">
          <input type="range" id="perception-months" min="0" max="24" value="3" step="1" style="width: 100%;" oninput="updatePerceptionValue(this.value)">
          <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.5rem;">
            <span>0 months</span>
            <span id="perception-value" style="font-weight: 600; color: var(--brand-orange);">3 months</span>
            <span>24 months</span>
          </div>
        </div>
      </div>

      <div style="background: var(--cream); padding: 1.5rem; border-radius: var(--radius-lg); margin-top: 2rem;">
        <p style="font-size: 0.9rem; color: var(--text-secondary); margin: 0;">
          <strong>Why we ask:</strong> This helps us show you how your perception compares to reality &mdash; many people are surprised by the gap.
        </p>
      </div>

      <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
        <button class="btn btn--secondary" style="flex: 1;" onclick="nextStep(3)">Back</button>
        <button class="btn btn--primary" style="flex: 1;" onclick="calculateScore()">Get My Score</button>
      </div>
    </div>

    <!-- Results -->
    <div class="wellness-step" id="wellness-results" style="display: none;">

      <!-- ===== SECTION: Your Score ===== -->
      <div class="results-section">
        <!-- Score Gauge (speedometer dial) -->
        <div style="text-align: center; padding: 1.5rem 0 0;">
          <h3 class="results-section__heading">Your Mortgage Readiness Score</h3>
          <div id="score-gauge-container" style="max-width: 280px; margin: 1rem auto 0;"></div>
          <div id="score-label" style="margin-top: 1rem;"></div>
        </div>

        <!-- Strengths & Improvements -->
        <div class="results-strengths-grid">
          <div>
            <p class="results-strengths-grid__label results-strengths-grid__label--green">Strengths</p>
            <ul id="strengths-list" class="results-strengths-grid__list"></ul>
          </div>
          <div>
            <p class="results-strengths-grid__label results-strengths-grid__label--orange">Areas to Improve</p>
            <ul id="improve-list" class="results-strengths-grid__list"></ul>
          </div>
        </div>
      </div>

      {{/* ===== COMMENTED OUT — sections moved to full report page =====

      <!-- ===== SECTION: Financial Runway ===== -->
      <div class="results-section">
        <h3 class="results-section__heading">How Long Could You Survive?</h3>
        <p class="results-section__intro">If you lost your income tomorrow &mdash; through redundancy, illness or injury &mdash; how long could you keep up with your essential outgoings? This is your financial runway, and lenders look for evidence of a safety net.</p>

        <div id="runway-callout" class="runway-callout">
          <div class="runway-callout__days">
            <span id="runway-days" class="runway-callout__number">0</span>
            <span class="runway-callout__unit"> days</span>
          </div>
          <p id="runway-message" class="runway-callout__message">If your income stopped tomorrow, your savings would cover essential expenses for approximately X days.</p>
          <div id="runway-comparison" class="runway-callout__comparison">
            <span>UK average: <strong>19 days</strong></span>
            <span>Target: <strong>90 days</strong></span>
          </div>
        </div>
      </div>

      <!-- ===== SECTION: Mortgage Eligibility ===== -->
      <div id="mortgage-metrics-dashboard" style="display: none;"></div>

      <!-- ===== SECTION: Score Breakdown ===== -->
      <div class="results-section">
        <h3 class="results-section__heading">How Your Score Breaks Down</h3>
        <p class="results-section__intro">Your overall score is built from four pillars. The radar chart shows how you compare across each area, while the bar chart highlights individual category scores.</p>
        <div class="wellness-charts-grid">
          <div class="wellness-chart-card">
            <h4 style="text-align: center; margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">Four Pillar Analysis</h4>
            <canvas id="radar-chart" style="max-height: 300px;"></canvas>
          </div>
          <div class="wellness-chart-card">
            <h4 style="text-align: center; margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">Category Scores</h4>
            <canvas id="bar-chart" style="max-height: 300px;"></canvas>
          </div>
        </div>
      </div>

      <!-- ===== SECTION: Reality Check ===== -->
      <div class="results-section">
        <div id="perception-gap-section" style="background: var(--cream); padding: 2rem; border-radius: var(--radius-lg);">
          <h3 class="results-section__heading">Reality Check</h3>
          <p class="results-section__intro">Earlier we asked how long you thought your savings would last. Here's how your estimate compared to the numbers.</p>
          <div style="max-width: 600px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
              <div style="text-align: center; padding: 1.5rem; background: white; border-radius: var(--radius-md);">
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">You Estimated</p>
                <p id="perception-estimated" style="font-family: var(--font-display); font-size: 2.5rem; color: var(--brand-charcoal); margin: 0;">0</p>
                <p style="font-size: 0.875rem; color: var(--text-secondary);">days</p>
              </div>
              <div style="text-align: center; padding: 1.5rem; background: white; border-radius: var(--radius-md); border: 2px solid var(--brand-orange);">
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">The Reality</p>
                <p id="perception-actual" style="font-family: var(--font-display); font-size: 2.5rem; color: var(--brand-orange); margin: 0;">0</p>
                <p style="font-size: 0.875rem; color: var(--text-secondary);">days</p>
              </div>
            </div>
            <p id="perception-message" style="text-align: center; font-size: 1rem; color: var(--text-secondary);"></p>
            <p style="text-align: center; font-size: 0.9rem; color: var(--text-secondary); margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--medium-grey);">If you don't want to rely on savings alone, <strong>Income Protection</strong> can replace a portion of your income during periods of illness or injury &mdash; keeping your mortgage payments covered when you need it most.</p>
          </div>
        </div>
      </div>

      <!-- ===== SECTION: Income Protection ===== -->
      <div class="results-section">
        <h3 class="results-section__heading">What If You Couldn't Work?</h3>
        <p class="results-section__intro">A mortgage is typically a 25-year commitment. The chart below shows what would happen to your income over the first 6 months if illness or injury stopped you working, taking into account your employer benefits and any state support.</p>

        <div style="background: white; padding: 2rem; border-radius: var(--radius-lg); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
          <canvas id="waterfall-chart" style="max-height: 400px;"></canvas>
          <div id="benefit-explanation" style="display: none; margin-top: 1.5rem; padding: 1rem 1.25rem; background: #F0F4FF; border-left: 3px solid #3B82F6; border-radius: 0 8px 8px 0;"></div>
        </div>

        <!-- Risk Probability Cards -->
        <div style="margin-top: 2rem;">
          <h4 style="text-align: center; margin-bottom: 0.5rem; font-size: 1rem;">The Statistics Over a 25-Year Mortgage</h4>
          <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">Based on your age and profile, the likelihood of these events during your mortgage term:</p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
            <div id="risk-death" class="risk-stat-card">
              <p class="risk-stat-card__value">0%</p>
              <p class="risk-stat-card__label">Chance of death</p>
            </div>
            <div id="risk-ci" class="risk-stat-card">
              <p class="risk-stat-card__value">0%</p>
              <p class="risk-stat-card__label">Chance of critical illness</p>
            </div>
            <div id="risk-absence" class="risk-stat-card">
              <p class="risk-stat-card__value">0%</p>
              <p class="risk-stat-card__label">Chance of 2+ month absence</p>
            </div>
          </div>
          <p style="text-align: center; font-size: 0.8rem; color: var(--text-secondary); margin-top: 1.5rem;">These are statistical averages for illustrative purposes. Individual circumstances vary and should be discussed with a qualified adviser.</p>
        </div>
      </div>

      ===== END COMMENTED OUT ===== */}}

      <!-- ===== SECTION: Actions ===== -->
      <div class="results-section" style="border-bottom: none; padding-bottom: 0;">
        <div id="report-actions" style="text-align: center; padding: 1.5rem; background: var(--cream); border-radius: var(--radius-lg);">
          <h3 class="results-section__heading">Save Your Results</h3>
          <p style="font-size: 0.9rem; margin-bottom: 1rem;">Share your results or download a detailed report to discuss with an adviser.</p>
          <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <a id="view-full-report-btn" class="btn btn--primary" href="#" style="display: none;" target="_blank" rel="noopener">View Full Report</a>
            {{/* <button id="share-report-btn" class="btn btn--secondary" style="display: none;">Share Report Link</button> */}}
            <button id="download-pdf-btn" class="btn btn--secondary" style="display: none;">Download PDF Report</button>
          </div>
          <div id="loading-indicator" style="display: none; margin-top: 1rem;">
            <p style="color: var(--brand-orange);">Processing...</p>
          </div>
        </div>

        <div style="text-align: center; padding-top: 1.5rem; margin-top: 1.5rem; border-top: 1px solid var(--medium-grey);">
          <p style="margin-bottom: 1rem;">Want to discuss your results with an expert?</p>
          <a href="/contact/" class="btn btn--primary">Book a Free Consultation &rarr;</a>
          <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem;">This assessment is indicative only and does not guarantee mortgage acceptance.</p>
        </div>
      </div>
    </div>

    </div><!-- /.wellness-modal__scroll -->
  </div>
</div>

<!-- Wellness config injected from Hugo data files -->
<script>
window.BMS_CONFIG = {
  scoreCategories: {{ .Site.Data.scoring.scoreCategories.tiers | jsonify | safeJS }},
  runwayStatus: {{ .Site.Data.benchmarks.runwayStatus.tiers | jsonify | safeJS }},
  ltiScoring: {{ .Site.Data.scoring.ltiScoring | jsonify | safeJS }},
  dtiScoring: {{ .Site.Data.scoring.dtiScoring | jsonify | safeJS }},
  depositLtvScoring: {{ .Site.Data.scoring.depositLtvScoring | jsonify | safeJS }},
  perceptionGap: {{ .Site.Data.scoring.perceptionGap | jsonify | safeJS }},
  daysPerMonth: {{ .Site.Data.benchmarks.runwayTargets.daysPerMonth }}
};
</script>
<!-- Wellness Modal Scripts (deferred to avoid blocking) -->
<script defer src="{{ "js/wellness-client.js" | relURL }}"></script>
